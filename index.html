
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>>>>ChatğŸ“¢Room<<<</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

    :root {
      --bg:#010208;
      --muted:#09113c;
      --accent1:#6969d1;
      --accent2:#7698e2;
      --me-gradient:linear-gradient(135deg,#8388b8,#0d2f5c);
    }

    *{box-sizing:border-box;}
    body,html{margin:0;height:100%;font-family:'Inter',sans-serif;background:var(--bg);color:#061827;}
    .container{display:flex;flex-direction:column;height:100vh;}

   header {
  padding: 10px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  box-shadow: 0 2px 10px rgba(136, 136, 184, 0.5);
}

/* Logo */
.chat-logo {
  width: 60px;
  height: 60px;
  margin-right:2px;
}

/* Chatroom name link */
.chatroom-link {
  font-size: 1.2em;
  font-weight: 700;
  text-decoration: none;
  background: linear-gradient(135deg, var(--accent1), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  position: relative;
  padding-bottom: 4px;
  transition: all 0.3s ease;
  cursor: pointer;
}

/* Animated underline */
.chatroom-link::after {
  content: "";
  position: absolute;
  left: 0;
  bottom: 0;
  width: 100%;
  height: 3px;
  background: linear-gradient(135deg, var(--accent2), var(--accent1));
  transform: scaleX(0);
  transform-origin: right;
  transition: transform 0.3s ease;
}

.chatroom-link:hover::after {
  transform: scaleX(1);
  transform-origin: left;
}

/* Hover effect: slightly enlarge and shadow */
.chatroom-link:hover {
  transform: scale(1.05);
  text-shadow: 0 0 6px rgb(16, 1, 1);
}


/* Adjust buttons */
header button {
  border:none;
  padding:8px 14px;
  border-radius:6px;
  background:linear-gradient(135deg,var(--accent1),var(--accent2));
  color:#963434;
  font-weight:600;
  cursor:pointer;
  margin-top:4px;
}
    /* Instructions */
    #instructions{
      max-height:0;overflow:hidden;
      transition:max-height 0.4s ease,padding 0.3s ease;
      padding:auto;background:rgb(236, 225, 225);
      border-bottom:auto solid rgba(20, 3, 3);
    }
    #instructions.open{max-height:300px;padding:12px;font-size:0.4em;line-height:1;}

    /* Setup */
    .setup{
      padding:12px;background:linear-gradient(#2d3fc7);
      display:flex;gap:8px;flex-wrap:wrap;
    }
    .setup input{
      flex:1;min-width:120px;padding:10px 14px;border-radius:8px;border:none;
      background:rgb(12, 6, 6);color:#fff;
    }
    .setup input::placeholder{color:#cbd5e1;}
    .setup button{
      padding:10px 16px;border:none;border-radius:8px;
      background:linear-gradient(135deg,var(--accent1),var(--accent2));
      color:#fff;font-weight:600;cursor:pointer;
    }

    /* Room header */
    .room-header{
      padding:14px;text-align:center;font-weight:600;
      background:rgba(255,255,255,0.05);
      display:flex;align-items:center;justify-content:center;gap:8px;flex-wrap:wrap;
      overflow-x:auto;
    }
    .room-header span{color:var(--accent2);font-weight:700;}
    .room-header button{
      border:none;padding:6px 12px;border-radius:6px;
      background:linear-gradient(135deg,var(--accent1),var(--accent2));color:#fff;
      cursor:pointer;white-space:nowrap;
    }

    /* Messages */
   #messages {
  flex: 1; /* fill available vertical space */
  overflow-y: auto; /* enable vertical scroll */
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  background: radial-gradient(#6dddd4);
  scroll-behavior: smooth; /* smooth scroll on new messages */
  padding-bottom: 80px; /* space for composer */

}

  .message {
max-width: 85%;
padding: 12px 16px;
border-radius: 16px;
line-height: 1.4;
word-wrap: break-word;
backdrop-filter: blur(8px);
box-shadow: 0 4px 10px rgba(0,0,0,0.3);
font-size: 15px;
}
.message.emoji {
  font-size: 22px;
  text-align: left;
  background: transparent;
  box-shadow: none;
}
.message .meta {
  font-size: 12px;
  color: var(--muted);
  margin-bottom: 4px;
}

  .message.other {
align-self: flex-start;
color: hsl(244, 85%, 10%);
border-bottom-left-radius: 4px;

/* Glassy water effect */
background: rgba(255, 255, 255, 0.15); /* translucent */
backdrop-filter: blur(12px) saturate(180%);
-webkit-backdrop-filter: blur(12px) saturate(180%);

border: 1px solid rgba(255, 255, 255, 0.3);
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);

  /* optional glossy gradient overlay */
  background-image: linear-gradient(
    to top left,
    rgba(255, 255, 255, 0.25),
    rgba(255, 255, 255, 0.05)
  );
}

    .message.me {
  align-self: flex-end;
  color: hsl(238, 93%, 5%);
  border-bottom-right-radius: 4px;

  /* Glassy water effect with dark tint */
  background: rgba(137, 137, 208, 0.3); /* darker glass tint */
  backdrop-filter: blur(12px) saturate(200%);
  -webkit-backdrop-filter: blur(12px) saturate(200%);

  border: 1px solid rgba(255, 255, 255, 0.25);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);

  /* glossy highlight */
  background-image: linear-gradient(
    to top left,
    rgba(255, 255, 255, 0.2),
    rgba(255, 255, 255, 0.05)
  );
}


    /* Composer */
   .composer {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  display: flex;
  gap: 25px;
  padding: 6px;
  background: rgba(30, 30, 60, 0.95);
  border-top: 1px solid rgba(255,255,255,0.1);
  z-index: 1000;
}

.composer textarea {
  flex: 1;
  padding: 10px 10px;
  border-radius: 18px;
  border: none;
  resize: none;
  background: rgba(255,255,255,0.1);
  color: #fff;
  min-height: 30px;     /* âœ… avoids zoom */
  font-size: 16px;      /* âœ… avoids zoom on iOS */
  line-height: 1;
  overflow-y: auto;
}

.composer button {
  padding: 0 16px;
  border: none;
  border-radius: 20px;
  background: linear-gradient(135deg, var(--accent1), var(--accent2));
  color: #fff;
  font-weight: 800;
  cursor: pointer;
  min-width: 7px;
}
    /* Responsive tweaks */
    @media(max-width:600px){
      .message{max-width:85%;font-size:15px;}
      .setup input, .setup button{flex:1 1 100%; margin-bottom:6px;}
      .composer textarea{min-height:50px;}
      header h1{font-size:1em;}
    }

    /* Header container */
.header-top {
  display: flex;
  align-items: center;
  justify-content: space-between; /* Push logo left, button right */
  padding: 10px 10px;
  background: linear-gradient(#263f75);
  box-shadow: 0 2px 10px rgba(0,0,0,0.5);
  flex-wrap: wrap; /* Wrap on very small screens */
  gap: 10px;
}

/* Logo */
.chat-logo {
  width: 40px;
  height: 40px;
  object-fit: contain;
}

/* Chatroom Link */
.chatroom-link {
  font-size: 2em;
  font-weight: 700;
  text-decoration: none;
  background: linear-gradient(#e0e0e7);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  white-space: nowrap;
  transition: all 0.3s ease;
}

.chatroom-link:hover {
  transform: scale(1.05);
  text-shadow: 0 0 6px rgba(255,255,255,0.6);
}

/* Instructions Button */
#instructions-btn {
  border: none;
  padding: 8px 14px;
  border-radius: 6px;
  background: linear-gradient(135deg,#6366f1,#3b82f6);
  color: #fff;
  font-weight: 600;
  cursor: pointer;
  white-space: nowrap;
  transition: transform 0.2s;
}

#instructions-btn:hover {
  transform: scale(1.05);
}

/* Responsive tweaks */
@media (max-width: 600px) {
  .header-top {
    justify-content: center;
    gap: 15px;
  }

  .chat-logo {
    width: 32px;
    height: 32px;
  }

  .chatroom-link {
    font-size: 1em;
  }

  #instructions-btn {
    padding: 10px 10px;
    font-size: 0.9em;
  }
}
/* Invite Modal Styles */
.invite-modal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  display: none;
  justify-content: center;
  align-items: center;
  background: rgba(0, 0, 0, 0.6);
  z-index: 2000;
  backdrop-filter: blur(4px);
}

.invite-modal.show {
  display: flex;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from {opacity: 0;}
  to {opacity: 1;}
}

.invite-box {
  background: rgba(255, 255, 255, 0.95);
  border-radius: 14px;
  padding: 20px;
  width: 90%;
  max-width: 400px;
  text-align: center;
  box-shadow: 0 6px 18px rgba(0,0,0,0.3);
  animation: popUp 0.25s ease;
}

@keyframes popUp {
  from {transform: scale(0.9); opacity: 0;}
  to {transform: scale(1); opacity: 1;}
}

.invite-box h3 {
  margin-top: 0;
  color: #202a44;
  font-weight: 700;
}

#invite-message {
  width: 100%;
  height: 60px;
  margin: 10px 0;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 8px;
  resize: none;
  font-size: 14px;
}

#invite-link {
  width: 100%;
  border: 1px solid #bbb;
  border-radius: 6px;
  padding: 8px;
  font-size: 13px;
  background: #f3f3f3;
  color: #333;
}

.invite-actions {
  display: flex;
  justify-content: space-between;
  margin-top: 12px;
}

.invite-actions button {
  flex: 1;
  margin: 0 4px;
  border: none;
  border-radius: 8px;
  padding: 10px;
  font-weight: 700;
  cursor: pointer;
  transition: 0.2s ease;
}

#copy-link-btn {
  background: linear-gradient(135deg, #00c6ff, #0072ff);
  color: #fff;
}
#copy-link-btn:hover {
  transform: scale(1.05);
}

#close-invite-btn {
  background: #eee;
  color: #333;
}
#close-invite-btn:hover {
  background: #ddd;
}

</style>
</head>
<body>
 <script>
  // Array of light gradient options
  const gradients = [
  "radial-gradient(circle at center, #fdfbfb, #ebedee)",   // soft white/grey
  "radial-gradient(circle at center, #f6d365, #fda085)",   // peach
  "radial-gradient(circle at center, #a1c4fd, #c2e9fb)",   // light blue
  "radial-gradient(circle at center, #d4fc79, #96e6a1)",   // green/yellow
  "radial-gradient(circle at center, #fbc2eb, #a6c1ee)",   // pink/purple
  "radial-gradient(circle at center, #ffecd2, #fcb69f)",   // pastel orange
  "radial-gradient(circle at center, #cfd9df, #e2ebf0)",   // very light gray/blue
  "radial-gradient(circle at center, #e0c3fc, #8ec5fc)",   // lavender-blue
  "radial-gradient(circle at center, #f9f586, #a6e7ff)",   // lemon sky
  "radial-gradient(circle at center, #ffdde1, #ee9ca7)",   // pink-peach
  "radial-gradient(circle at center, #c2e9fb, #e2fcff)",   // icy blue
  "radial-gradient(circle at center, #fdfbfb, #dfe9f3)",   // light cloud
  "radial-gradient(circle at center, #f8e2cf, #f1f2b5)",   // cream-yellow
  "radial-gradient(circle at center, #f6f0c4, #d0e6a5)",   // lime sorbet
  "radial-gradient(circle at center, #e0c3fc, #f9f9f9)",   // soft violet white
  "radial-gradient(circle at center, #e8cbc0, #636fa4)",   // dusty purple
  "radial-gradient(circle at center, #ffefba, #ffffff)",   // warm white
  "radial-gradient(circle at center, #a1ffce, #faffd1)",   // mint-vanilla
  "radial-gradient(circle at center, #d9afd9, #97d9e1)",   // pastel purple-blue
  "radial-gradient(circle at center, #fff1eb, #ace0f9)",   // sky peach
  "radial-gradient(circle at center, #ffd1ff, #f5c7f7)",   // cotton candy
  "radial-gradient(circle at center, #ff9a9e, #fecfef)",   // pink fade
  "radial-gradient(circle at center, #f6d365, #fda085)",   // golden peach
  "radial-gradient(circle at center, #fbc2eb, #a6c1ee)",   // rosy lavender
  "radial-gradient(circle at center, #cfd9df, #e2ebf0)",   // icy grey
  "radial-gradient(circle at center, #e0c3fc, #8ec5fc)",   // purple blue
  "radial-gradient(circle at center, #d4fc79, #96e6a1)",   // lime mint
  "radial-gradient(circle at center, #fbc2eb, #f9c6e0)",   // pink blush
  "radial-gradient(circle at center, #a8edea, #fed6e3)",   // aqua pink
  "radial-gradient(circle at center, #f5f7fa, #c3cfe2)",   // frost
  "radial-gradient(circle at center, #fdfcfb, #e2d1c3)",   // beige sand
  "radial-gradient(circle at center, #f1f2b5, #135058)",   // light teal
  "radial-gradient(circle at center, #fffcdc, #d9a7c7)",   // peach lavender
  "radial-gradient(circle at center, #a6c0fe, #f68084)",   // pastel red-blue
  "radial-gradient(circle at center, #fccb90, #d57eeb)",   // warm lavender
  "radial-gradient(circle at center, #fddb92, #d1fdff)",   // peach aqua
  "radial-gradient(circle at center, #9890e3, #b1f4cf)",   // violet mint
  "radial-gradient(circle at center, #fff6b7, #f6416c)",   // yellow-pink
  "radial-gradient(circle at center, #e0c3fc, #f9c5d1)",   // violet rose
  "radial-gradient(circle at center, #cfd9df, #a6c1ee)",   // grey violet
  "radial-gradient(circle at center, #d299c2, #fef9d7)",   // lilac cream
  "radial-gradient(circle at center, #fddb92, #d1fdff)",   // golden aqua
  "radial-gradient(circle at center, #fceabb, #f8b500)",   // honey
  "radial-gradient(circle at center, #d9a7c7, #fffcdc)",   // lavender blush
  "radial-gradient(circle at center, #f6d365, #fda085)",   // orange peach
  "radial-gradient(circle at center, #ffecd2, #fcb69f)",   // sunny blush
  "radial-gradient(circle at center, #ffdde1, #ee9ca7)",   // sunset pink
  "radial-gradient(circle at center, #ff9a9e, #fecfef)",   // blush pink
  "radial-gradient(circle at center, #cfd9df, #e2ebf0)",   // cloudy day
  "radial-gradient(circle at center, #a1c4fd, #c2e9fb)",   // light sky
  "radial-gradient(circle at center, #fbc2eb, #a6c1ee)",   // lavender rose
  "radial-gradient(circle at center, #fdfbfb, #ebedee)",   // cloudy white
  "radial-gradient(circle at center, #d4fc79, #96e6a1)",   // spring green
  "radial-gradient(circle at center, #fff1eb, #ace0f9)"    // soft sky
];


  // Pick one at random on each refresh
  const randomGradient = gradients[Math.floor(Math.random() * gradients.length)];

  // Apply to background (example: messages area)
  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("messages").style.background = randomGradient;
  });
</script>


<div class="container">
 <header class="header-top">
  <!-- Logo -->
  <img src="logochat.png" alt="Chat Logo" class="chat-logo">
  <!-- Chatroom Name as Link -->
  <a href="https://hematics43.github.io/ChatRoom/" id="chatroom-link" class="chatroom-link">>>>ChatğŸ“¢Room<<<</a>
  <!-- Instructions Button -->
  <button id="instructions-btn">âš™ï¸Instruction</button>
</header>

 <div id="instructions">
  <h2>ğŸ“– How to Use ChatRoom Logo >>></h2>
  <ol>
   <li><p class="note"></p>ğŸ”‘ Enter a <b>Room Code</b> & <b>Nickname</b>, then click <b>Join</b>.</li>
    <li><p class="note"></p>ğŸ² Or click <b>Generate Room</b> to make a new one & share it.</li>
    <li><p class="note"></p>ğŸ’¬ Chat instantly â€” your messages are on the right, others on the left.</li>
    <li><p class="note"></p>ğŸ§¹ Use <b>ğŸ’¾ as Download chats</b>, <b>ğŸ—‘ï¸ as Clear all chats</b>,<b>ğŸ”š as Exit chat room</b></li>
    <li><p class="note">âš ï¸ Note: Rooms are always active. If everyone leaves, the chat history will be in room.</p></li></ol>
</div>

<!-- Setup -->
  <div class="setup" id="setup">
    <input id="room-input" type="text" placeholder="Room Code"/>
    <input id="name-input" type="text" placeholder="Nickname"/>
    <button id="join-btn">ğŸ¤Join</button>
    <button id="gen-btn">ğŸ¤–Generate Room</button>
  </div>

  <!-- Room header -->
  <div class="room-header" id="room-display" style="display:none;">
    <span id="room-code-text"></span>
    <button id="download-btn" style="display:none;">ğŸ’¾</button>
    <button id="clear-btn">ğŸ—‘ï¸</button>
    <button id="leave-btn">ğŸ”š</button>
    <button id="sound-btn">ğŸ”Š</button>
    <button id="invite-btn">ğŸ”—</button>
  </div>

  <!-- Messages -->
  <div id="messages"></div>

  <!-- Composer -->
  <div class="composer">
    <textarea id="msg-input" placeholder="Write here..." disabled></textarea>
    <button id="send-btn" disabled>ğŸ“¢ğŸ“©ğŸ“©ğŸ“©</button>
  </div>
  <!-- Invite Modal -->
<div id="invite-modal" class="invite-modal">
  <div class="invite-box">
    <h3>ğŸ”— Share Room Invitation</h3>
    <p>Your room code: <strong id="invite-room-code"></strong></p>
    <textarea id="invite-message" placeholder="Write a short message...">Join me in this chat ğŸ“¢</textarea>
    <input id="invite-link" type="text" readonly />
    <div class="invite-actions">
      <button id="copy-link-btn">ğŸ“‹ Copy Link</button>
      <button id="close-invite-btn">âŒ Close</button>
    </div>
  </div>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, push, onChildAdded, remove } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
const inviteBtn = document.getElementById("invite-btn");
const inviteModal = document.getElementById("invite-modal");
const inviteRoomCode = document.getElementById("invite-room-code");
const inviteMessage = document.getElementById("invite-message");
const inviteLink = document.getElementById("invite-link");
const copyLinkBtn = document.getElementById("copy-link-btn");
const closeInviteBtn = document.getElementById("close-invite-btn");


// Open invite modal
inviteBtn.onclick = () => {
  if (!activeRoom) return alert("Join a room first!");
  const baseUrl = window.location.origin + window.location.pathname;
  const link = `${baseUrl}?room=${encodeURIComponent(activeRoom)}&msg=${encodeURIComponent(inviteMessage.value)}`;
  
  inviteRoomCode.textContent = activeRoom;
  inviteLink.value = link;
  inviteModal.classList.add("show");
};

// Update link as message changes
inviteMessage.addEventListener("input", () => {
  const baseUrl = window.location.origin + window.location.pathname;
  const link = `${baseUrl}?room=${encodeURIComponent(activeRoom)}&msg=${encodeURIComponent(inviteMessage.value)}`;
  inviteLink.value = link;
});

// Copy link to clipboard
copyLinkBtn.onclick = async () => {
  try {
    await navigator.clipboard.writeText(inviteLink.value);
    copyLinkBtn.textContent = "âœ… Copied!";
    setTimeout(() => copyLinkBtn.textContent = "ğŸ“‹ Copy Link", 2000);
  } catch {
    alert("Could not copy the link. Please copy it manually.");
  }
};


// Close modal
closeInviteBtn.onclick = () => inviteModal.classList.remove("show");
inviteModal.onclick = e => { if (e.target === inviteModal) inviteModal.classList.remove("show"); };

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAKUkKJLa1XSV4NwjFBrG2M2g3ObkE5CbI",
  authDomain: "code-chatroom.firebaseapp.com",
  projectId: "code-chatroom",
  storageBucket: "code-chatroom.appspot.com",
  messagingSenderId: "207673617291",
  appId: "1:207673617291:web:d25bfef5658e6504acdd8e",
  databaseURL: "https://code-chatroom-default-rtdb.asia-southeast1.firebasedatabase.app/"
};


const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
// Notification sound
const popSound = new Audio("pop.wav");
popSound.volume = 0.3; // soft volume

// Elements
const setup=document.getElementById("setup");
const roomInput=document.getElementById("room-input");
const nameInput=document.getElementById("name-input");
const joinBtn=document.getElementById("join-btn");
const genBtn=document.getElementById("gen-btn");
const roomDisplay=document.getElementById("room-display");
const roomCodeText=document.getElementById("room-code-text");
const downloadBtn=document.getElementById("download-btn");
const messagesEl=document.getElementById("messages");
const msgInput=document.getElementById("msg-input");
const sendBtn=document.getElementById("send-btn");
const instrBtn=document.getElementById("instructions-btn");
const instructions=document.getElementById("instructions");
const leaveBtn = document.getElementById("leave-btn");
const clearBtn = document.getElementById("clear-btn");
const soundBtn = document.getElementById("sound-btn");
let soundEnabled = true;

const quickEmojis = [
  "â¤ï¸", // red heart
  "ğŸ§¡", // orange heart
  "ğŸ’›", // yellow heart
  "ğŸ’š", // green heart
  "ğŸ’™", // blue heart
  "ğŸ’œ", // purple heart
  "ğŸ¤", // white heart
  "ğŸ’–", // sparkling heart
  "ğŸ’—", // growing heart
  "ğŸ’“", // beating heart
  "ğŸ’", // revolving hearts
  "ğŸ’•", // two hearts
  "ğŸ’", // heart with ribbon
  "ğŸ’˜", // heart with arrow
  "ğŸ’Ÿ", // heart decoration
  "â£ï¸", // heavy heart exclamation
  "ğŸ’”"  // broken heart
];



let activeRoom=null;
let nickname=null;

// Toggle instructions
instrBtn.onclick=()=>{
  instructions.classList.toggle("open");
  instrBtn.textContent = instructions.classList.contains("open") ? "Hide Instructions" : "Instructions";
};

// Render message
function renderMessage(data) {
  const msg = document.createElement("p");
let cls = "message " + (data.name === nickname ? "me" : "other");
if (data.type === "emoji") cls += " emoji";
msg.className = cls;
  const time = data.createdAt ? new Date(data.createdAt).toLocaleString() : "";
  msg.innerHTML = `<span class="meta">${data.name || "Anon"} Â· ${time}</span><br>ğŸ‘‰ ${data.text}`;
  messagesEl.appendChild(msg);

  // Auto-scroll to bottom
// Auto-scroll to the last message smoothly
setTimeout(() => {
  messagesEl.scrollTo({
    top: messagesEl.scrollHeight,
    behavior: "smooth"
  });
}, 100);
  
}
function autoScroll() {
  const nearBottom = messagesEl.scrollHeight - messagesEl.scrollTop - messagesEl.clientHeight < 150;
  if (nearBottom) {
    messagesEl.scrollTo({
      top: messagesEl.scrollHeight,
      behavior: "smooth"
    });
  }
}


// Join room
function joinRoom(room) {
  activeRoom = room;
  nickname = nameInput.value.trim() || "USER:";

  // Save session
  localStorage.setItem("chatroom", activeRoom);
  localStorage.setItem("nickname", nickname);

  messagesEl.innerHTML = "";
  setup.style.display = "none";
  roomDisplay.style.display = "flex";
  roomCodeText.innerHTML = `Room Code: <span>${activeRoom}</span>`;
  downloadBtn.style.display = "inline-block";
  msgInput.disabled = false;
  sendBtn.disabled = false;

  const messagesRef = ref(db, `messages/${activeRoom}`);
  onChildAdded(messagesRef, (snapshot) => {
  const data = snapshot.val();
  renderMessage(data);

  // ğŸ”” Play sound only for messages from others
  if (data.name !== nickname && soundEnabled) {
    popSound.currentTime = 0;
    popSound.play().catch(() => {});
  }
});


}

joinBtn.onclick=()=>{ if(roomInput.value.trim()) joinRoom(roomInput.value.trim()); };
genBtn.onclick=()=>{
  const code=Math.random().toString(36).substring(2,8).toUpperCase();
  roomInput.value=code; joinRoom(code);
};

// Restore session if exists
window.addEventListener("load", () => {
  const savedRoom = localStorage.getItem("chatroom");
  const savedName = localStorage.getItem("nickname");
  if (savedRoom && savedName) {
    roomInput.value = savedRoom;
    nameInput.value = savedName;
    joinRoom(savedRoom);
  }
});

// Send message
sendBtn.onclick = async () => {
  if (!msgInput.value.trim()) return;
  const messagesRef = ref(db, `messages/${activeRoom}`);
  await push(messagesRef, {
    name: nickname,
    text: msgInput.value.trim(),
    type: "text",
    createdAt: Date.now()
  });
  msgInput.value = "";
};
// Double-tap in messages area to send a random emoji
messagesEl.addEventListener("dblclick", async () => {
  if (!activeRoom || !nickname) return;

  // Pick a random emoji
  const emoji = quickEmojis[Math.floor(Math.random() * quickEmojis.length)];

  const messagesRef = ref(db, `messages/${activeRoom}`);
  await push(messagesRef, {
    name: nickname,
    text: emoji,
    type: "emoji",
    createdAt: Date.now()
  });
});

// Enter = send
msgInput.addEventListener("keydown", e => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    sendBtn.click();
  }
});

// Download chat
downloadBtn.onclick=()=>{
  let chatText=`Chatroom: ${activeRoom}\n====================\n\n`;
  messagesEl.querySelectorAll(".message").forEach(msg=>{
    const meta=msg.querySelector(".meta")?.textContent||"";
    const text=msg.innerText.replace(meta,"").replace(">>>","").trim();
    chatText+=`${meta}\n${text}\n\n`;
  });
  const blob=new Blob([chatText],{type:"text/plain"});
  const link=document.createElement("a");
  link.href=URL.createObjectURL(blob);
  link.download=`chatroom-${activeRoom}.txt`;
  link.click();
};

// Clear chat
clearBtn.onclick = async () => {
  if (!activeRoom) return;
  if (confirm("Are you sure you want to clear all messages in this room?")) {
    const messagesRef = ref(db, `messages/${activeRoom}`);
    await remove(messagesRef);
    messagesEl.innerHTML = "";
  }
};

// Quit chatroom
leaveBtn.onclick = () => {
  localStorage.removeItem("chatroom");
  localStorage.removeItem("nickname");
  activeRoom = null;
  nickname = null;
  messagesEl.innerHTML = "";
  setup.style.display = "flex";
  roomDisplay.style.display = "none";
  msgInput.disabled = true;
  sendBtn.disabled = true;
};

soundBtn.onclick = () => {
  soundEnabled = !soundEnabled;
  soundBtn.textContent = soundEnabled ? "ğŸ”Š" : "ğŸ”‡";
};

</script>
</body>
</html>
